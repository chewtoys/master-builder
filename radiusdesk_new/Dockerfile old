FROM nginx:latest
    RUN apt-get update && apt-get upgrade -y
    RUN apt-get -y install php-cli php-mysql php-gd php-curl php-xml php-mbstring php-intl git wget
    ## Install the RADIUSdesk RDCore based on CakePHP v3 Application

    # Check out the RdCore git repository.
    # This will create an rdcore directory containing some sub-folders.
    RUN cd /usr/share/nginx/
    RUN git clone https://github.com/RADIUSdesk/rdcore.git
    
    # We will create soft links in the directory where Nginx will serve the RdCore contents.
    RUN cd /usr/share/nginx/html
    RUN sudo ln -s ../rdcore/rd ./rd
        sudo ln -s ../rdcore/cake3 ./cake3
        sudo ln -s ../rdcore/login ./login
        sudo ln -s ../rdcore/AmpConf/build/production/AmpConf ./conf_dev
        sudo ln -s ../rdcore/login/rd_client/build/production/AmpConf ./usage
        sudo ln -s ../rdcore/cake3/rd_cake/setup/scripts/reporting ./reporting

    # Change the ownership of the following files to www-data so Nginx can make changes to the files/directories
    RUN sudo mkdir -p  /var/www/html/cake3/rd_cake/logs
        sudo mkdir -p /var/www/html/cake3/rd_cake/webroot/files/imagecache
        sudo mkdir -p /var/www/html/cake3/rd_cake/tmp
        sudo chown -R www-data. /var/www/html/cake3/rd_cake/tmp
        sudo chown -R www-data. /var/www/html/cake3/rd_cake/logs
        sudo chown -R www-data. /var/www/html/cake3/rd_cake/webroot/img/realms
        sudo chown -R www-data. /var/www/html/cake3/rd_cake/webroot/img/dynamic_details
        sudo chown -R www-data. /var/www/html/cake3/rd_cake/webroot/img/dynamic_photos
        sudo chown -R www-data. /var/www/html/cake3/rd_cake/webroot/img/access_providers
        sudo chown -R www-data. /var/www/html/cake3/rd_cake/webroot/img/hardwares
        sudo chown -R www-data. /var/www/html/cake3/rd_cake/webroot/files/imagecache  
    

    ## Got up to here
      
    ##RUN service php7.3-fpm reload
    RUN apt-get install subversion -y
    RUN cd /usr/share/nginx/html/cake2/
    RUN svn checkout svn://dvdwalt@svn.code.sf.net/p/radiusdesk/code/trunk/rd_cake ./rd_cake/
    RUN cd /usr/share/nginx/html/
    RUN chown -R www-data. /usr/share/nginx/html/cakephp-2.10.22/
    ## Install the RADIUSdesk CakePHP v3 Application
    RUN cd /usr/share/nginx/html/ && svn checkout svn://dvdwalt@svn.code.sf.net/p/radiusdesk/code/trunk/cake3 ./cake3/
    RUN chown -R www-data. /usr/share/nginx/html/cake3/
    ## Viewer Component
    RUN cd /usr/share/nginx/html/ && \
        svn checkout svn://dvdwalt@svn.code.sf.net/p/radiusdesk/code/trunk/rd ./rd/ && \
        svn checkout svn://svn.code.sf.net/p/radiusdesk/code/extjs ./ && \
        mv  ext-6-2-sencha_cmd.tar.gz ./rd/ && \
        cd /usr/share/nginx/html/rd/ && \
        tar -xzvf ext-6-2-sencha_cmd.tar.gz
    #RUN cp /usr/share/nginx/html/cake2/rd_cake/Setup/Cron/rd /etc/cron.d/
